from __future__ import annotations

SUPPORTED_LANGUAGES: dict[str, str] = {
    "zh": "繁體中文",
    "en": "English",
    "ja": "日本語",
    "ko": "한국어",
}

TEXTS: dict[str, dict[str, str]] = {
    "zh": {
        "app_title": "元素蒐集大挑戰",
        "main_start_gacha": "開始抽卡",
        "main_collection": "圖鑑",
        "main_settings": "設定",
        "main_exit": "離開",
        "back_to_menu": "返回主選單",
        "gacha_draw_count_label": "一次抽卡數量：",
        "gacha_ticket": "抽卡券：{current} / {cap}",
        "gacha_speed_paid": "券生成：每 1 秒 +1",
        "gacha_speed_free": "券生成：每 60 秒 +1",
        "gacha_stats": "總抽卡：{total}｜已收集：{collected}/118",
        "insufficient_tickets": "抽卡券不足 ({current} / {need})",
        "collection_progress": "圖鑑進度：{collected}/118",
        "collection_mode_rarity": "分段圖鑑",
        "collection_mode_periodic": "元素週期表",
        "periodic_legend_title": "顏色分類",
        "settings_title": "設定",
        "settings_unlock_title": "付費解鎖",
        "settings_save_title": "存檔管理",
        "settings_language_title": "語言",
        "settings_apply_unlock_code": "套用解鎖碼",
        "settings_apply_language": "套用語言",
        "settings_clear_save": "清除存檔",
        "settings_export_save": "匯出存檔",
        "settings_unlock_wrong": "解鎖碼錯誤。",
        "settings_already_unlocked": "目前已是付費解鎖狀態。",
        "settings_unlock_success": "解鎖成功。",
        "settings_status_unlocked": "狀態：已解鎖（每 {seconds} 秒 +1，上限 {cap}）",
        "settings_status_locked": "狀態：未解鎖（每 {seconds} 秒 +1，上限 {cap}）",
        "settings_language_changed": "語言已切換。",
        "settings_confirm_title": "確認",
        "settings_confirm_clear_1": "確定要清除存檔嗎？",
        "settings_confirm_clear_2_title": "再次確認",
        "settings_confirm_clear_2": "此操作不可復原，確定繼續？",
        "settings_save_cleared": "存檔已清除。",
        "settings_export_dialog_title": "匯出存檔",
        "settings_export_done": "已匯出到：{path}",
        "detail_panel_title": "元素詳細資料",
        "detail_placeholder": "點擊任一卡片查看詳細資料",
        "detail_atomic_number": "原子序",
        "detail_symbol": "元素符號",
        "detail_local_name": "中文名",
        "detail_name_en": "英文名",
        "detail_rarity": "稀有度",
        "detail_earth_abundance": "地球含量",
        "detail_owned_count": "已抽到數量",
        "detail_abundance_na": "N/A（人工元素或資料不足）",
        "rarity_1": "極常見",
        "rarity_2": "常見",
        "rarity_3": "不常見",
        "rarity_4": "稀有",
        "rarity_5": "極稀有",
        "collection_section_1": "極常見 50%",
        "collection_section_2": "常見 30%",
        "collection_section_3": "不常見 14.5%",
        "collection_section_4": "稀有 5%",
        "collection_section_5": "極稀有 0.5%",
        "category_alkali_metal": "鹼金屬",
        "category_alkaline_earth": "鹼土金屬",
        "category_transition_metal": "過渡金屬",
        "category_post_transition_metal": "後過渡金屬",
        "category_metalloid": "類金屬",
        "category_nonmetal": "非金屬",
        "category_halogen": "鹵素",
        "category_noble_gas": "惰性氣體",
        "category_lanthanide": "鑭系",
        "category_actinide": "錒系",
        "category_unknown": "未知分類",
    },
    "en": {
        "app_title": "Element Gacha Collection",
        "main_start_gacha": "Start Gacha",
        "main_collection": "Collection",
        "main_settings": "Settings",
        "main_exit": "Exit",
        "back_to_menu": "Back to Menu",
        "gacha_draw_count_label": "Draw amount:",
        "gacha_ticket": "Tickets: {current} / {cap}",
        "gacha_speed_paid": "Ticket speed: +1 / 1s",
        "gacha_speed_free": "Ticket speed: +1 / 60s",
        "gacha_stats": "Total Draws: {total} | Collected: {collected}/118",
        "insufficient_tickets": "Insufficient tickets ({current} / {need})",
        "collection_progress": "Collection: {collected}/118",
        "collection_mode_rarity": "Rarity View",
        "collection_mode_periodic": "Periodic Table",
        "periodic_legend_title": "Color Categories",
        "settings_title": "Settings",
        "settings_unlock_title": "Paid Unlock",
        "settings_save_title": "Save Management",
        "settings_language_title": "Language",
        "settings_apply_unlock_code": "Apply Unlock Code",
        "settings_apply_language": "Apply Language",
        "settings_clear_save": "Clear Save",
        "settings_export_save": "Export Save",
        "settings_unlock_wrong": "Invalid unlock code.",
        "settings_already_unlocked": "Already unlocked.",
        "settings_unlock_success": "Unlock successful.",
        "settings_status_unlocked": "Status: Unlocked (+1 every {seconds}s, cap {cap})",
        "settings_status_locked": "Status: Locked (+1 every {seconds}s, cap {cap})",
        "settings_language_changed": "Language changed.",
        "settings_confirm_title": "Confirm",
        "settings_confirm_clear_1": "Clear save data?",
        "settings_confirm_clear_2_title": "Confirm Again",
        "settings_confirm_clear_2": "This cannot be undone. Continue?",
        "settings_save_cleared": "Save cleared.",
        "settings_export_dialog_title": "Export Save",
        "settings_export_done": "Exported to: {path}",
        "detail_panel_title": "Element Details",
        "detail_placeholder": "Click any card to view details",
        "detail_atomic_number": "Atomic Number",
        "detail_symbol": "Symbol",
        "detail_local_name": "Local Name",
        "detail_name_en": "English Name",
        "detail_rarity": "Rarity",
        "detail_earth_abundance": "Earth Abundance",
        "detail_owned_count": "Owned Count",
        "detail_abundance_na": "N/A (Synthetic element or data unavailable)",
        "rarity_1": "Very Common",
        "rarity_2": "Common",
        "rarity_3": "Uncommon",
        "rarity_4": "Rare",
        "rarity_5": "Ultra Rare",
        "collection_section_1": "Very Common 50%",
        "collection_section_2": "Common 30%",
        "collection_section_3": "Uncommon 14.5%",
        "collection_section_4": "Rare 5%",
        "collection_section_5": "Ultra Rare 0.5%",
        "category_alkali_metal": "Alkali Metals",
        "category_alkaline_earth": "Alkaline Earth Metals",
        "category_transition_metal": "Transition Metals",
        "category_post_transition_metal": "Post-transition Metals",
        "category_metalloid": "Metalloids",
        "category_nonmetal": "Nonmetals",
        "category_halogen": "Halogens",
        "category_noble_gas": "Noble Gases",
        "category_lanthanide": "Lanthanides",
        "category_actinide": "Actinides",
        "category_unknown": "Unknown",
    },
    "ja": {
        "app_title": "元素ガチャコレクション",
        "main_start_gacha": "ガチャ開始",
        "main_collection": "図鑑",
        "main_settings": "設定",
        "main_exit": "終了",
        "back_to_menu": "メニューへ戻る",
        "gacha_draw_count_label": "一回の抽選数：",
        "gacha_ticket": "チケット：{current} / {cap}",
        "gacha_speed_paid": "生成速度：1秒ごとに+1",
        "gacha_speed_free": "生成速度：60秒ごとに+1",
        "gacha_stats": "総抽選：{total}｜収集：{collected}/118",
        "insufficient_tickets": "チケット不足 ({current} / {need})",
        "collection_progress": "図鑑進捗：{collected}/118",
        "collection_mode_rarity": "レア度表示",
        "collection_mode_periodic": "周期表表示",
        "periodic_legend_title": "色分類",
        "settings_title": "設定",
        "settings_unlock_title": "有料解除",
        "settings_save_title": "セーブ管理",
        "settings_language_title": "言語",
        "settings_apply_unlock_code": "解除コード適用",
        "settings_apply_language": "言語を適用",
        "settings_clear_save": "セーブ削除",
        "settings_export_save": "セーブ書き出し",
        "settings_unlock_wrong": "解除コードが違います。",
        "settings_already_unlocked": "すでに解除済みです。",
        "settings_unlock_success": "解除に成功しました。",
        "settings_status_unlocked": "状態：解除済み（{seconds}秒ごとに+1、上限 {cap}）",
        "settings_status_locked": "状態：未解除（{seconds}秒ごとに+1、上限 {cap}）",
        "settings_language_changed": "言語を変更しました。",
        "settings_confirm_title": "確認",
        "settings_confirm_clear_1": "セーブを削除しますか？",
        "settings_confirm_clear_2_title": "再確認",
        "settings_confirm_clear_2": "この操作は元に戻せません。続行しますか？",
        "settings_save_cleared": "セーブを削除しました。",
        "settings_export_dialog_title": "セーブ書き出し",
        "settings_export_done": "書き出し先：{path}",
        "detail_panel_title": "元素詳細",
        "detail_placeholder": "カードをクリックすると詳細を表示します",
        "detail_atomic_number": "原子番号",
        "detail_symbol": "元素記号",
        "detail_local_name": "日本語名",
        "detail_name_en": "英語名",
        "detail_rarity": "レア度",
        "detail_earth_abundance": "地球含有量",
        "detail_owned_count": "所持数",
        "detail_abundance_na": "N/A（人工元素またはデータ不足）",
        "rarity_1": "最も一般",
        "rarity_2": "一般",
        "rarity_3": "やや希少",
        "rarity_4": "希少",
        "rarity_5": "超希少",
        "collection_section_1": "最も一般 50%",
        "collection_section_2": "一般 30%",
        "collection_section_3": "やや希少 14.5%",
        "collection_section_4": "希少 5%",
        "collection_section_5": "超希少 0.5%",
        "category_alkali_metal": "アルカリ金属",
        "category_alkaline_earth": "アルカリ土類金属",
        "category_transition_metal": "遷移金属",
        "category_post_transition_metal": "典型金属",
        "category_metalloid": "半金属",
        "category_nonmetal": "非金属",
        "category_halogen": "ハロゲン",
        "category_noble_gas": "希ガス",
        "category_lanthanide": "ランタノイド",
        "category_actinide": "アクチノイド",
        "category_unknown": "未知分類",
    },
    "ko": {
        "app_title": "원소 가챠 컬렉션",
        "main_start_gacha": "가챠 시작",
        "main_collection": "도감",
        "main_settings": "설정",
        "main_exit": "종료",
        "back_to_menu": "메뉴로 돌아가기",
        "gacha_draw_count_label": "한 번에 뽑기 수량:",
        "gacha_ticket": "티켓: {current} / {cap}",
        "gacha_speed_paid": "생성 속도: 1초마다 +1",
        "gacha_speed_free": "생성 속도: 60초마다 +1",
        "gacha_stats": "총 뽑기: {total} | 수집: {collected}/118",
        "insufficient_tickets": "티켓 부족 ({current} / {need})",
        "collection_progress": "도감 진행도: {collected}/118",
        "collection_mode_rarity": "희귀도 보기",
        "collection_mode_periodic": "주기율표 보기",
        "periodic_legend_title": "색상 분류",
        "settings_title": "설정",
        "settings_unlock_title": "유료 해금",
        "settings_save_title": "저장 관리",
        "settings_language_title": "언어",
        "settings_apply_unlock_code": "해금 코드 적용",
        "settings_apply_language": "언어 적용",
        "settings_clear_save": "저장 삭제",
        "settings_export_save": "저장 내보내기",
        "settings_unlock_wrong": "해금 코드가 잘못되었습니다.",
        "settings_already_unlocked": "이미 해금된 상태입니다.",
        "settings_unlock_success": "해금에 성공했습니다.",
        "settings_status_unlocked": "상태: 해금됨 ({seconds}초마다 +1, 한도 {cap})",
        "settings_status_locked": "상태: 미해금 ({seconds}초마다 +1, 한도 {cap})",
        "settings_language_changed": "언어가 변경되었습니다.",
        "settings_confirm_title": "확인",
        "settings_confirm_clear_1": "저장 데이터를 삭제할까요?",
        "settings_confirm_clear_2_title": "다시 확인",
        "settings_confirm_clear_2": "이 작업은 되돌릴 수 없습니다. 계속할까요?",
        "settings_save_cleared": "저장이 삭제되었습니다.",
        "settings_export_dialog_title": "저장 내보내기",
        "settings_export_done": "내보낸 위치: {path}",
        "detail_panel_title": "원소 상세 정보",
        "detail_placeholder": "카드를 클릭하면 상세 정보를 표시합니다",
        "detail_atomic_number": "원자 번호",
        "detail_symbol": "원소 기호",
        "detail_local_name": "한국어 이름",
        "detail_name_en": "영문 이름",
        "detail_rarity": "희귀도",
        "detail_earth_abundance": "지구 함량",
        "detail_owned_count": "보유 수량",
        "detail_abundance_na": "N/A (인공 원소 또는 데이터 부족)",
        "rarity_1": "매우 흔함",
        "rarity_2": "흔함",
        "rarity_3": "보통",
        "rarity_4": "희귀",
        "rarity_5": "매우 희귀",
        "collection_section_1": "매우 흔함 50%",
        "collection_section_2": "흔함 30%",
        "collection_section_3": "보통 14.5%",
        "collection_section_4": "희귀 5%",
        "collection_section_5": "매우 희귀 0.5%",
        "category_alkali_metal": "알칼리 금속",
        "category_alkaline_earth": "알칼리 토금속",
        "category_transition_metal": "전이 금속",
        "category_post_transition_metal": "후전이 금속",
        "category_metalloid": "준금속",
        "category_nonmetal": "비금속",
        "category_halogen": "할로젠",
        "category_noble_gas": "비활성 기체",
        "category_lanthanide": "란타넘족",
        "category_actinide": "악티늄족",
        "category_unknown": "미분류",
    },
}

_JA_ELEMENT_NAMES: dict[int, str] = {
    1: "水素",
    2: "ヘリウム",
    3: "リチウム",
    4: "ベリリウム",
    5: "ホウ素",
    6: "炭素",
    7: "窒素",
    8: "酸素",
    9: "フッ素",
    10: "ネオン",
    11: "ナトリウム",
    12: "マグネシウム",
    13: "アルミニウム",
    14: "ケイ素",
    15: "リン",
    16: "硫黄",
    17: "塩素",
    18: "アルゴン",
    19: "カリウム",
    20: "カルシウム",
    21: "スカンジウム",
    22: "チタン",
    23: "バナジウム",
    24: "クロム",
    25: "マンガン",
    26: "鉄",
    27: "コバルト",
    28: "ニッケル",
    29: "銅",
    30: "亜鉛",
    31: "ガリウム",
    32: "ゲルマニウム",
    33: "ヒ素",
    34: "セレン",
    35: "臭素",
    36: "クリプトン",
    47: "銀",
    53: "ヨウ素",
    54: "キセノン",
    74: "タングステン",
    78: "白金",
    79: "金",
    80: "水銀",
    82: "鉛",
    92: "ウラン",
    118: "オガネソン",
}

_KO_ELEMENT_NAMES: dict[int, str] = {
    1: "수소",
    2: "헬륨",
    3: "리튬",
    4: "베릴륨",
    5: "붕소",
    6: "탄소",
    7: "질소",
    8: "산소",
    9: "플루오린",
    10: "네온",
    11: "나트륨",
    12: "마그네슘",
    13: "알루미늄",
    14: "규소",
    15: "인",
    16: "황",
    17: "염소",
    18: "아르곤",
    19: "칼륨",
    20: "칼슘",
    21: "스칸듐",
    22: "티타늄",
    23: "바나듐",
    24: "크롬",
    25: "망가니즈",
    26: "철",
    27: "코발트",
    28: "니켈",
    29: "구리",
    30: "아연",
    47: "은",
    53: "아이오딘",
    54: "제논",
    74: "텅스텐",
    78: "백금",
    79: "금",
    80: "수은",
    82: "납",
    92: "우라늄",
    118: "오가네손",
}


def normalize_language(value: str | None) -> str:
    if value in SUPPORTED_LANGUAGES:
        return value
    return "zh"


def t(language: str, key: str, **kwargs: object) -> str:
    lang = normalize_language(language)
    text = TEXTS.get(lang, {}).get(key) or TEXTS["zh"].get(key) or key
    if kwargs:
        return text.format(**kwargs)
    return text


def rarity_label(language: str, rarity: int) -> str:
    return t(language, f"rarity_{rarity}")


def collection_section_title(language: str, rarity: int) -> str:
    return t(language, f"collection_section_{rarity}")


def periodic_category_label(language: str, category: str) -> str:
    return t(language, f"category_{category}")


def element_name(language: str, atomic_number: int, name_zh: str, name_en: str) -> str:
    lang = normalize_language(language)
    if lang == "zh":
        return name_zh
    if lang == "ja":
        return _JA_ELEMENT_NAMES.get(atomic_number, name_en)
    if lang == "ko":
        return _KO_ELEMENT_NAMES.get(atomic_number, name_en)
    return name_en
